{{$countryName := (replace_suffix .InputName "Location" "Country") }}
{{$cityName := (replace_suffix .InputName "Location" "City") }}
{{$regionName := (replace_suffix .InputName "Location" "Region") }}
{{$addressName := (replace_suffix .InputName "Location" "Address") }}
{{$zipName := (replace_suffix .InputName "Location" "Zip") }}
{{$latitudeName := (replace_suffix .InputName "Location" "Latitude") }}
{{$longitudeName := (replace_suffix .InputName "Location" "Longitude") }}

<div data-location="true">
  <label>{{dt (printf "%v.attributes.%v" .Base.ToParam "Location") "Location"}}</label>

  <div>
    <label>{{dt (printf "%v.attributes.%v.%v" .Base.ToParam "Loation" "Country") "Country"}}</label>
    <input type="text" data-location-role="country" name="{{$countryName}}" value="{{.Value.Country}}">

    <label>{{dt (printf "%v.attributes.%v.%v" .Base.ToParam "Loation" "City") "City"}}</label>
    <input type="text" data-location-role="city" name="{{$cityName}}" value="{{.Value.City}}">

    <label>{{dt (printf "%v.attributes.%v.%v" .Base.ToParam "Loation" "Region") "Region"}}</label>
    <input type="text" data-location-role="region" name="{{$regionName}}" value="{{.Value.Region}}">

    <label>{{dt (printf "%v.attributes.%v.%v" .Base.ToParam "Loation" "Address") "Address"}}</label>
    <input type="text" data-location-role="address" name="{{$addressName}}" value="{{.Value.Address}}">

    <label>{{dt (printf "%v.attributes.%v.%v" .Base.ToParam "Loation" "Zip") "Zip"}}</label>
    <input type="text" data-location-role="zip" name="{{$zipName}}" value="{{.Value.Zip}}">

    <input type="hidden" data-location-role="latitude" name="{{$latitudeName}}" value="{{.Value.Latitude}}">
    <input type="hidden" data-location-role="longitude" name="{{$longitudeName}}" value="{{.Value.Longitude}}">

    <a href="javascript:;" data-location-role="geocode">{{dt (printf "%v.%v.%v" .Base.ToParam "Loation" "Search on Map") "Search on Map"}}</a>
    <a href="javascript:;" data-location-role="reverseGeocode">{{dt (printf "%v.%v.%v" .Base.ToParam "Loation" "Set Address from Marker") "Set Address from Marker"}}</a>

    <div data-location-role="map"></div>
    <div data-location-role="currentAddress"></div>
  </div>
</div>

<!-- Avoid loading google map js multiple times -->
<script type="text/javascript">
  (function () {
    var afterSlideOutOpen = function(callback) {
      var loadedLocation = false;
      var loadingInterval = setInterval(function() {
        if (!loadedLocation && $('body').hasClass("qor-slideout-open")) {
          callback.call(this);
          loadedLocation = true;
          clearInterval(loadingInterval);
        }
      }, 200)
    };

    var tagId = 'location-google-map-script-tag';
    if (!document.getElementById(tagId)) {
      var tagjs = document.createElement("script");
      var s = document.getElementsByTagName("script")[0];
      tagjs.async = true;
      tagjs.defer = true;
      tagjs.id = tagId;
      tagjs.src = "//maps.googleapis.com/maps/api/js?callback=Location.Init";
      s.parentNode.insertBefore(tagjs, s);
    } else {
      afterSlideOutOpen(Location.Init);
    }
  }());
</script>
