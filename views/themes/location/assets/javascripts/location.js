"use strict";function qorInitMapAssets(i){$(i).each(function(){var i=$(this),t=i.data(),o=t.locationMapsource,e=t[o+"Apikey"],a="qor_map_"+o,n=void 0;if("baidu"===o){if($("#"+a).length)return void new QorLocation($(this)).initBaiduMap();n="//api.map.baidu.com/api?v=2.0&ak="+e+"&callback=qorInitBaiduMap"}else if("google"===o){if($("#"+a).length)return void new QorLocation($(this)).initBaiduMap();n="//maps.googleapis.com/maps/api/js?key="+e+"&callback=qorInitGoogleMap"}else console.log("QOR only support baidu or google Map, please make sure your Map config is correct!");qorLoadMapScript(n,a)})}function qorInitBaiduMap(){$('[data-toggle="qor.location"]').each(function(){new QorLocation($(this)).initBaiduMap()})}function qorInitGoogleMap(){$('[data-toggle="qor.location"]').each(function(){new QorLocation($(this)).initGoogleMap()})}function qorLoadMapScript(i,t){var o=document.createElement("script");o.src=i,o.id=t,document.body.appendChild(o)}function QorLocation(i,t){this.$element=$(i),this.options=$.extend({},QorLocation.DEFAULTS,$.isPlainObject(t)&&t),this.roles={},this.init()}QorLocation.prototype={constructor:QorLocation,init:function(){var i=this.$element.find("[data-location-role]"),t=this.roles,o=void 0;i.each(function(){o=$(this).data("location-role"),t["$"+o]=$(this)}),this.bind()},bind:function(){this.roles.$reverseGeocode.on("click",this.getAddress.bind(this)),this.roles.$geocode.on("click",this.getPosition.bind(this))},unbind:function(){},initGoogleMap:function(){},initBaiduMap:function(){var i=this.roles,t=Number(i.$latitude.val()),o=Number(i.$longitude.val()),e=new BMap.Point(o,t),a=this;if(0===t&&0===o){(new BMap.Geolocation).getCurrentPosition(function(i){this.getStatus()==BMAP_STATUS_SUCCESS?a.setupBaiduMap(i.point):console.log("failed"+this.getStatus())},{enableHighAccuracy:!0})}else this.setupBaiduMap(e)},setupBaiduMap:function(i){var t=new BMap.Map(this.$element.find(".qor__location-map")[0]);t.centerAndZoom(i,18),t.enableScrollWheelZoom();var o=new BMap.Marker(i);t.addOverlay(o),t.panTo(i),o.enableDragging(),this.marker=o,this.baiduMap=t,this.baiduMapGeo=new BMap.Geocoder,this.moveBaiduMapMarker(o.getPosition()),o.addEventListener("dragend",this.moveBaiduMapMarker.bind(this))},moveBaiduMapMarker:function(i){var t=this.$element.find(".qor__location-address");this.baiduMapGeo.getLocation(new BMap.Point(i.lng||i.point.lng,i.lat||i.point.lat),function(i){i&&t.html(i.address)})},getPosition:function(){var i=this.baiduMap,t=this.roles,o=this.marker,e=t.$city.val(),a=t.$address.val(),n=this.baiduMapGeo;if(""==e||""==a)return void window.QOR.qorConfirm("Please ensure that the city and address have been filled in correctly!");n.getPoint(a,function(e){e&&(t.$latitude.val(e.lat),t.$longitude.val(e.lng),i.centerAndZoom(e,18),o.setPosition(e))},e)},getAddress:function(){var i=this.marker.getPosition();this.roles.$latitude.val(i.lat),this.roles.$longitude.val(i.lng),this.getAddressFromPosition(i)},getAddressFromPosition:function(i){var t=this.baiduMapGeo,o=this.roles;t.getLocation(new BMap.Point(i.lng,i.lat),function(i){i&&(o.$address.val(i.address),o.$city.val(i.addressComponents.city),o.$region.val(i.addressComponents.district))})}},$(function(){var i='[data-toggle="qor.location"]';qorInitMapAssets(i),$(document).on("enable.qor.location",function(){qorInitMapAssets(i)})});