"use strict";function qorInitMapAssets(t){$(t).each(function(){var t=$(this),i=t.data(),o=i.locationMapsource,e=i[o+"Apikey"],n="qor_map_"+o,a=void 0;if("baidu"===o){if($("#"+n).length)return void new QorLocation($(this)).initBaiduMap();a="//api.map.baidu.com/api?v=2.0&ak="+e+"&callback=qorInitBaiduMap"}else if("google"===o){if($("#"+n).length)return void new QorLocation($(this)).initBaiduMap();a="//maps.googleapis.com/maps/api/js?key="+e}else console.log("QOR only support baidu or google Map, please make sure your Map config is correct!");qorLoadMapScript(a,n)})}function qorInitBaiduMap(){$('[data-toggle="qor.location"]').each(function(){new QorLocation($(this)).initBaiduMap()})}function qorLoadMapScript(t,i){var o=document.createElement("script");o.src=t,o.id=i,document.body.appendChild(o)}function QorLocation(t,i){this.$element=$(t),this.options=$.extend({},QorLocation.DEFAULTS,$.isPlainObject(i)&&i),this.roles={},this.init()}QorLocation.prototype={constructor:QorLocation,init:function(){var t=this.$element.find("[data-location-role]"),i=this.roles,o=void 0;t.each(function(){o=$(this).data("location-role"),i["$"+o]=$(this)}),this.bind()},bind:function(){this.roles.$reverseGeocode.on("click",this.getAddress.bind(this)),this.roles.$geocode.on("click",this.getPosition.bind(this))},unbind:function(){},initBaiduMap:function(){var t=this.roles,i=Number(t.$latitude.val()),o=Number(t.$longitude.val()),e=new BMap.Point(o,i),n=this;if(0===i&&0===o){(new BMap.Geolocation).getCurrentPosition(function(t){this.getStatus()==BMAP_STATUS_SUCCESS?n.setupBaiduMap(t.point):console.log("failed"+this.getStatus())},{enableHighAccuracy:!0})}else this.setupBaiduMap(e)},setupBaiduMap:function(t){var i=new BMap.Map(this.$element.find(".qor__location-map")[0]);i.centerAndZoom(t,18),i.enableScrollWheelZoom();var o=new BMap.Marker(t);i.addOverlay(o),i.panTo(t),o.enableDragging(),this.marker=o,this.baiduMap=i},getPosition:function(){var t=this.baiduMap,i=this.roles,o=this.marker,e=i.$city.val(),n=i.$address.val(),a=new BMap.Geocoder;if(""==e||""==n)return void window.QOR.qorConfirm("Please ensure that the city and address have been filled in correctly!");a.getPoint(n,function(e){e&&(i.$latitude.val(e.lat),i.$longitude.val(e.lng),t.centerAndZoom(e,18),o.setPosition(e))},e)},getAddress:function(){var t=this.marker.getPosition();this.roles.$latitude.val(t.lat),this.roles.$longitude.val(t.lng),this.getAddressFromPosition(t)},getAddressFromPosition:function(t){var i=new BMap.Geocoder,o=this.roles;i.getLocation(new BMap.Point(t.lng,t.lat),function(t){t&&(o.$address.val(t.address),o.$city.val(t.addressComponents.city),o.$region.val(t.addressComponents.district))})}},$(function(){var t='[data-toggle="qor.location"]';qorInitMapAssets(t),$(document).on("enable.qor.location",function(){qorInitMapAssets(t)})});